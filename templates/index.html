<!DOCTYPE html>
<html>
<head>
	<title>VinDesk</title>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js"></script>
	<link rel="stylesheet" type="text/css" href="static/css/stylesheet.css">
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
	  <a class="navbar-brand" href="#"><i class="fas fa-align-left"></i> VinDesk</a>
	  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
	    <span class="navbar-toggler-icon"></span>
	  </button>

	  <div class="collapse navbar-collapse" id="navbarColor02">
	    <ul class="navbar-nav mr-auto">
	      <li class="nav-item active">
	        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
	      </li>
	      <li class="nav-item">
	        <a class="nav-link" href="#">Features</a>
	      </li>
	      <li class="nav-item">
	        <a class="nav-link" href="#">Pricing</a>
	      </li>
	      <li class="nav-item">
	        <a class="nav-link" href="#">About</a>
	      </li>
	    </ul>
	  </div>
	</nav>
	<div class="jumbotron">
		<div class="container">
			<div class="row">
				<div class="col">
					<h1>VIN Lookup <svg width="54px"  height="54px"  xmlns="http://www.w3.org/2000/svg" viewBox="0 -20 100 100" preserveAspectRatio="xMidYMid" class="lds-ripple" style="background: none;"><circle cx="50" cy="50" r="11.1027" fill="none" ng-attr-stroke="{{config.c1}}" ng-attr-stroke-width="{{config.width}}" stroke="#24c6f4" stroke-width="5"><animate attributeName="r" calcMode="spline" values="0;30" keyTimes="0;1" dur="1" keySplines="0 0.2 0.8 1" begin="-0.5s" repeatCount="indefinite"></animate><animate attributeName="opacity" calcMode="spline" values="1;0" keyTimes="0;1" dur="1" keySplines="0.2 0 0.8 1" begin="-0.5s" repeatCount="indefinite"></animate></circle><circle cx="50" cy="50" r="25.5541" fill="none" ng-attr-stroke="{{config.c2}}" ng-attr-stroke-width="{{config.width}}" stroke="#ff0453" stroke-width="5"><animate attributeName="r" calcMode="spline" values="0;30" keyTimes="0;1" dur="1" keySplines="0 0.2 0.8 1" begin="0s" repeatCount="indefinite"></animate><animate attributeName="opacity" calcMode="spline" values="1;0" keyTimes="0;1" dur="1" keySplines="0.2 0 0.8 1" begin="0s" repeatCount="indefinite"></animate></circle></svg></h1>
					<p>Enter your VIN below and return specific information about your vehicle.</p>
					<form action="#" method="post" id="myForm">
					<i class="fas fa-angle-right fa-5x wobble" id="pointer"></i><input type="text" name="vin" id="vinID">
					<div class="bar"></div>
					<br><br>
					<button type="submit" class="btn btn-primary" id="submitBtn">Submit</button>
					</form>						
				</div>
				<div class="col">
					<h2 id="results"></h2>
					<table class="table table-hover">
					  <tbody id="instantData">
					    <tr>

					    </tr>
					  </tbody>
					</table>
					<!-- Button trigger modal -->
					<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" id="previewImg">
					  Show Image Preview
					</button>
					<button type="button" class="btn btn-info" id="moreInfo">More Info</button>

					<!-- Modal -->
					<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
					  <div class="modal-dialog" role="document">
					    <div class="modal-content">
					      <div class="modal-header">
					        <h5 class="modal-title" id="exampleModalLabel">Image</h5>
					        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
					          <span aria-hidden="true">&times;</span>
					        </button>
					      </div>
					      <div class="modal-body">
					        Generating...
					      </div>
					      <div class="modal-footer">
					        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
					      </div>
					    </div>
					  </div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/mojs/latest/mo.min.js"></script>
	<script type="text/javascript">
		$("#submitBtn").hide();
		$(".lds-ripple").hide();
		$("#previewImg").hide();
		$("#moreInfo").hide();
		$(document).ready(function(){
			var resultText;
			setInterval(function() {
				var idLength = $('#vinID').val().length;
				if (idLength > 0) {
					$("#submitBtn").show();
				} else {
					$("#submitBtn").hide();
				}
			}, 10);
			$("#myForm").submit(function(e) {
				e.preventDefault();
				$(".lds-ripple").show();
				$.ajax({
					url: '/checkvin',
					type: 'post',
					data: $("#myForm").serialize()
				}).done(function(response) {
					console.log(response['data']);
					$(".lds-ripple").hide();
					var year = response['data'][8]['Value'];
					var model = response['data'][5]['Value'];
					var make = response['data'][7]['Value'];
					var series = response['data'][10]['Value'];
					var trim = response['data'][11]['Value'];
					if (!series) {
						resultText = year + " " + model + " " + make + " " + trim;
					} else {
						resultText = year + " " + model + " " + make + " " + series;
					}
					function allExists(value) {
						return value;
					}

					var myArray = [year, model, make];
					var foundMatch = myArray.every(allExists);
					if (!foundMatch) {
						$("#results").html('No match found.');
						$("#instantData").html("");
						$("#previewImg").fadeOut('fast');
						$("#moreInfo").fadeOut('fast');
					} else {
						$("#results").html("⭐️ Car Found: " + resultText);

						var origin = response['data'][13]['Value'];
						var manufacturer = response['data'][6]['Value'];
						var vehicleType = response['data'][12]['Value'];
						var doors = response['data'][23]['Value'];

						var t1 = '<tr><th scope="row">Made In</th><td>' + origin + '</td></tr>';
						var t2 = '<tr><th scope="row">Manufacturer</th><td>' + manufacturer + '</td></tr>';
						var t3 = '<tr><th scope="row">Type</th><td>' + vehicleType + '</td></tr>';
						var t4 = '<tr><th scope="row">Doors</th><td>' + doors + '</td></tr>';

						$("#instantData").html(t1 + t2 + t3 + t4);
						$("#previewImg").fadeIn('slow');
						setTimeout(function() {
							$("#moreInfo").fadeIn('slow');
						}, 3000);
					}
				});
			});
			$("#previewImg").click(function() {
				$(".lds-ripple").show();
				$('.modal-body').html('Generating...');
				var payload = {'query': resultText};
				$.ajax({
					url: '/retrieveImg',
					type: 'post',
					data: JSON.stringify(payload),
					contentType: 'application/json',
					dataType: 'json'
				}).done(function(response) {
					$(".lds-ripple").hide();
					var src = response['src'];
					$('.modal-body').html('<img src="' + src + '" style="max-width: 100%; max-height: 100%">');
				}).fail(function(){
					$(".lds-ripple").hide();
					$('.modal-body').html("Image could not be retrieved.");
				});
			});

		});
	</script>
</body>
</html>